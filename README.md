# CoCo-Translate
# 前提

大多數AI聊天平台都是英文，再加上AI聊天使用英文更具優勢，因此身為英文不好的人非常需要翻譯外掛功能。
由於機器翻譯有時候會翻錯或漏掉原文沒翻譯，在使用機器翻譯時最好要雙語對照。如果搜尋相關外掛會找到中國出產的「沉浸式翻譯」，但在隱私和資安方面非常讓人不安。
雖然也試過其他程式，但始終和我理想中的功能有差距。這時候我在R板看到了一則貼文寫著：「既然有AI了，為什麼不讓你的想法成真？」超雞湯，而且我喝了👍
於是我就開始和GPT一起寫這個瀏覽器外掛了。

聲明：我沒有學過程式，幾乎都是靠GPT先寫程式碼給我，我再邊看邊學和測試除蟲。所以這**絕對不會是**一個完美無缺的外掛，甚至會有一些我也沒發現的Bug。

最後更新日：2025/3/19

# 適用瀏覽器

Chrome、Firefox

# 最新版本

Ver.1.3.1.9

[原始說明文件（含圖片）](https://hypnotic-denim-05e.notion.site/CoCo-Translate-175cbce1913780ca8efbf2267976a0a7?pvs=74)

[更新日記](https://www.notion.so/176cbce1913780eba254f6b0d9b6638b?pvs=21)

[歷史版本](https://www.notion.so/192cbce19137803bb478e47ac589d5a1?pvs=21)

[清除快取](https://www.notion.so/1a1cbce1913780f7b850c0592ae7a0b9?pvs=21)

# 安裝方式

### **Chrome：**

1. 下載Chrome版本資料夾。
2. 開啟擴充功能管理頁面，並開啟「開發人員模式」。
3. 點選「載入未封裝項目」。
4. 選擇剛才解壓縮的資料夾。
5. 完成★

※更新時直接覆蓋舊資料，並重新載入便能保留資料。

### **Firefox：**

1. 下載XPI檔案。
2. 開啟擴充套件管理頁面。
3. 點選齒輪圖示。
4. 點選「從檔案安裝附加元件…」
5. 選擇剛才下載的XPI檔案進行安裝。
6. 完成★

※更新時可以直接安裝更新，資料會保留下來。

# 功能介紹

### 支援多家翻譯平台

- Google翻譯
- Bing翻譯
- Google Cloud Translation API（支援本地快取）
- DeepL API（支援本地快取）
- Mistral AI（支援本地快取與自訂Prompt）

### 觸發式雙語翻譯

- 游標懸停在段落上按下指定觸發鍵，即可在原文下方顯示對照譯文
- 選取文字後點擊懸浮按鈕或右鍵選單，即可在原文下方顯示對照譯文

### 整頁網頁翻譯

- 一鍵翻譯整個網頁，並能另外顯示原文
- 可自訂特定網站自動翻譯

### 翻譯輸入文字

- 點擊懸浮按鈕可開啟輸入框，輸入後翻譯、顯示結果
- 支援一鍵複製翻譯結果

### 自訂正規表達式修正譯文

- 可設定多組Regex來自動修正翻譯錯誤或統一用語
- 支援匯出及匯入JSON格式

<aside>
💡

**補充說明**

- 所有譯文會保留與原文相同的格式（包含圖片與排版）
- 若目標語言為繁中或日文，會自動將“”或""替換為「 」
- 可切換右鍵選單模式（預設選單、自訂選單、雙選單）
</aside>

# 使用說明

※安裝後，建議釘選至工具列。

### 彈出視窗：一般設定

1. **UI Language**：
介面語言。更改後立刻生效。
2. **Always translate this site：**
勾選後會在每次開啟該網站時自動翻譯整個網頁。
通常重整網頁後生效。出現Bug時請見[Bug說明](https://www.notion.so/CoCo-Translate-175cbce1913780ca8efbf2267976a0a7?pvs=21)。
3. **Show Original Text Tooltip in Page Translate：**
勾選後會在啟用Page Translate功能時，以提示框的方式顯示滑鼠經過的原文。重整網頁後生效。
4. **Enable Input Translate Button：**
勾選後會在網頁右下角顯示懸浮按鈕。點擊懸浮按鈕可叫出輸入訊息框與翻譯框。重整網頁後生效。
5. **Enable Selection Translation Button：**
勾選後會顯示觸發翻譯懸浮按鈕。重整網頁後生效。
6. **Enable Custom Regex：**
勾選後會啟用自訂正規表達式。再次翻譯時生效。
7. **Enable local cached translation：**
勾選後會啟用本地快取功能，將譯文永久儲存到瀏覽器的資料庫。
此功能僅適用於Cloud API、DeepL API、Mistral API，以減少API使用量。
8. **Translation Source：**
點擊「Click to open settings」後會開啟小視窗，可分別選擇觸發式翻譯與整頁翻譯的來源。
觸發式翻譯可選擇Google、Bing、Cloud Translation、DeepL API、Mistral API。
整頁翻譯可選擇Google、Bing、Cloud Translation、DeepL API。
在小視窗儲存設定並重整網頁後生效。
    
    <aside>
    💡
    
    ※使用AI翻譯時，請理解LLM可能會不聽指示。也就是說，譯文可能會跑出奇怪的回應或出現其他外語。
    
    </aside>
    
9. **Context Menu：**
選擇右鍵選單模式。更改後立刻生效。
    1. CoCo Menu：僅顯示本擴充的右鍵選單。
    2. Both Menu：同時顯示本擴充及瀏覽器預設的右鍵選單
    3. Default Menu：僅顯示瀏覽器的右鍵選單。
    
    <aside>
    💡
    
    ※擴充自訂的右鍵選單會顯示於游標左側。在Chrome瀏覽器同時開啟預設右鍵選單時，擴充右鍵選單可以正常使用，但不會有任何互動特效。
    
    </aside>
    
10. **Target Language：**
選擇翻譯的目標語言。可選擇繁中、英文、日文、韓文。儲存設定並重整網頁後生效。
11. **Input Target Language：**
選擇輸入訊息的翻譯目標語言。可選繁中、英文、日文、韓文。儲存設定並重整網頁後生效。
12. **Translation Trigger Key：**
設定觸發翻譯的觸發鍵。預設為右Ctrl。儲存設定並重整網頁後生效。
13. **Enable Translation：**
啟用或停用觸發翻譯功能。停用時會清空當前所有雙語對照譯文。**儲存設定後立即生效**。
14. **Save Settings：**
**修改第10項到第13項功能後，務必點擊儲存設定。**
15. **Clear Triggered：**
清除所有觸發翻譯的譯文。
16. **Translate Page：**
翻譯整個網頁。
17. **Restore Page：**
還原顯示整個網頁的原文。

### 彈出視窗：編輯正規表達式

1. **Add New Pattern：**
增加一組新的正規表達式。
2. **勾選框：**
快速啟用或停用該組正規表達式。
3. **Input Regex：**
想取代的目標文字。可以直接輸入文字，或是使用正規表達式。
4. **Output Replacement：**
想輸出的文字。可以直接輸入文字，或是使用正規表達式。
5. **Delete：**
刪除該組正規表達式。
6. **Export與Import：**
匯出與匯入正規表達式。可以在匯出後，直接按照檔案中的格式填寫正規表達式再匯入。**匯入檔案後會覆蓋現有的正規表達式。**

<aside>
💡

**※更新正規表達式後的生效時機：重新翻譯時。**

※Firefox受限於瀏覽器功能，點擊Import後會開啟Options頁面，請於該頁面匯入檔案。

</aside>

### API設定

1. **Cloud API Key：**
輸入Cloud Translation的API金鑰並儲存後，可使用該服務翻譯。按下刪除就能刪除金鑰。輸入和儲存的金鑰都會隱藏內容。
2. **DeepL API Key：**
輸入DeepL翻譯的API金鑰並儲存後，可使用該服務翻譯。按下刪除就能刪除金鑰。輸入和儲存的金鑰都會隱藏內容。
3. **Mistral API Key：**
輸入Mistral AI的API金鑰並儲存後，可以使用Mistral AI翻譯。按下刪除就能刪除金鑰。輸入和儲存的金鑰都會隱藏內容。
4. **DeepL Account Type：**
選擇輸入的DeepL API金鑰對應的訂閱方案。
5. Prompt Name：
新增自訂Prompt時輸入的名稱。
6. Custom Prompt：
新增自訂Prompt時輸入的Prompt內容。
    
    <aside>
    💡
    
    ※請務必加入「翻譯成${fullTargetLang}」之類的句子，這樣AI才抓得到目標語言是哪個。
    
    ※「${fullTargetLang}」會在程式內自動替換為選擇的目標語言，建議使用此標籤，而不是直接寫英文、繁中等語言名稱。
    
    ※Prompt建議使用英文書寫。
    
    </aside>
    
7. Save Prompt：
輸入完自訂Prompt的名稱和提示詞後，請按此按鈕儲存。
8. Select Prompt：
選擇Mistral AI翻譯要使用的Prompt。
9. Delete Prompt：
欲刪除所選擇的Prompt時，請按此按鈕。
10. **How to Clear Cached Translations：**
點擊後會開啟清除本地快取資料庫的[教學網頁](https://www.notion.so/1a1cbce1913780f7b850c0592ae7a0b9?pvs=21)。
之後會再試著開發完這個功能。
11. **Cache Size：**
當前網頁本地快取資料庫占用的空間大小。
~~但可能有bug……~~

<aside>
💡

※DeepL的API翻譯不支援繁體中文。

※使用API翻譯後沒有反應，或是顯示為原文時，請確認：

1. 是否已輸入有效的API金鑰。
2. 是否為不支援的語言對。

※DeepL API翻譯支援的語言請至官網查詢。
※Mistral AI翻譯速度較慢，因為要等AI跑完回應才會顯示譯文。
※使用AI翻譯時，請先了解LLM可能會不聽指示。也就是說，**譯文可能會跑出奇怪的回應或出現其他外語。**

</aside>

### 預設右鍵選單／自訂右鍵選單

1. **預設右鍵選單：**
    1. 選取文字的狀態下：
        1. Selection Translate：
        沒有譯文時，會翻譯選取原文的整個段落。
        已有譯文時，會清除選取原文段落的譯文。
        2. Clear Translations：
        清除所有觸發式雙語對照的譯文。
        3. Page Translate／Restore Page：
        翻譯整個網頁／顯示網頁原文。
    2. 未選取文字的狀態下：
        1. Clear Translations：
        清除所有觸發式雙語對照的譯文。
        2. Page Translate／Restore Page：
        翻譯整個網頁／顯示網頁原文。
2. **自訂右鍵選單：**
    1. C：清除所有觸發式雙語對照的譯文。
    2. R：顯示網頁原文／清除觸發式雙語對照譯文。~~其實後者是bug，但我懶得修。~~
    3. S：翻譯游標所在的原文段落。
    4. P：翻譯網頁。
    
    <aside>
    💡
    
    ※自訂右鍵選單會顯示於游標左側。
    
    ※在Chrome瀏覽器同時開啟預設右鍵選單時，擴充右鍵選單可以正常使用，但不會有任何互動特效。
    
    </aside>
    

### 觸發式雙語對照翻譯

1. **游標+觸發鍵：**
    1. 游標停在欲翻譯的原文上，按下觸發鍵後會翻譯該原文段落。
    2. 已有翻譯時，按下觸發鍵會清除該原文段落的譯文。
2. **選取文字+懸浮按鈕：**
    1. 選取文字後會顯示懸浮按鈕，按下按鈕後會翻譯該原文段落。
    2. 已有翻譯時，按下懸浮按鈕會清除該原文段落的譯文。

<aside>
💡

※本外掛只會翻譯一整個原文段落，沒有「只翻譯選取文字」的功能。
※方便快速的選取文字方式：滑鼠左鍵雙擊任意單字。

</aside>

### 清除雙語對照的譯文

1. **只清除所選段落的譯文：**
    1. 再次按下觸發鍵、懸浮按鈕或右鍵選單翻譯鍵。
2. **清除所有譯文：**
    1. 點擊彈出視窗的「Clear Triggered」按鈕。
    2. 在預設右鍵選單中選擇「Clear Translations」。
    3. 在擴充的自訂右鍵選單中選擇「C」。
    4. 將Enable Translation改為OFF時，也會立刻清除所有譯文。

### 翻譯整個網頁

1. **翻譯網頁：**
    1. 點擊外掛圖示開啟彈出視窗後，點擊「Translate Page」按鈕。
    2. 在預設右鍵選單中選擇「Page Translate」。
    3. 在自訂右鍵選單中選擇「P」。
2. **還原顯示網頁原文：**
    1. 點擊外掛圖示開啟彈出視窗後，點擊「Restore Page」按鈕。
    2. 在預設右鍵選單中選擇「Restore Page」。
    3. 在自訂右鍵選單中選擇「R」。

<aside>
💡

※啟用整頁翻譯功能的期間會停用觸發式翻譯功能，直到恢復顯示整頁原文。

</aside>

### 翻譯輸入文字

1. **翻譯輸入文字懸浮按鈕：**
在彈出視窗啟用Input Translate Button。
可拖曳。預設會顯示在網頁右下角，不使用時為半透明。
2. **點擊懸浮按鈕後，會出現輸入框、翻譯框與複製鍵。**
    1. 翻譯框：輸入文字的譯文，可編輯。關閉時不會清空。
    2. 輸入框：輸入文字，關閉時不會清空。
    3. 複製鍵：點擊後複製譯文。
    4. 翻譯鍵：點擊後翻譯輸入文字。
3. **關閉欄位：**
點擊輸入框、翻譯框、翻譯鍵及複製鍵外的任意處。

# 已知BUG

### ⚠觸發式翻譯可能會突然失控，把游標經過的地方全部翻譯：

解決方式：重整網頁、關閉觸發翻譯功能、重啟瀏覽器。建議將觸發鍵改為最不常使用的按鍵，個人推薦使用「Backslash鍵」。

### ⚠在網頁版Discord使用觸發式翻譯，會直接在原文訊息底下增加譯文版訊息：

解決方式：無。這其實不算Bug吧？

### ⚠啟用整頁翻譯功能時，如果是動態網頁，可能有部分訊息沒翻譯或沒還原：

解決方式：再按一次Translate Page或Restore Page。如果在還原後還是會重新翻譯時，請繼續按Restore Page（或是重整網頁會更快）。

### ⚠觸發式翻譯在特定格式或網頁下會翻譯一大段內容，卻沒有分段：

解決方式：無。Sorry，我無能為力。反正只有特定格式和網頁是這樣，我覺得不影響使用。

### ⚠有時候關閉總是翻譯此網站的功能後，還是一樣會自動翻譯該網站：

解決方式：在彈出視窗按一下「Restore Page」後應該會變正常。

### ⚠使用Bing翻譯時，翻譯出來的譯文還是原文：

解決方式：重整網頁，或間隔一段時間再試。Bing的調用比較麻煩，翻譯出來是原文就表示調用失敗。

# Q&A

### ❓為什麼不能只翻譯選取的文字？

答：因為我只想翻譯一整個段落。~~比起只翻譯選取的文字，我比較想弄字典功能。~~

### ❓為什麼翻譯整個網頁時，翻譯速度比較慢？

答：可能是因為做了防抖，再加上處理譯文格式的方式比較複雜吧。另外為了能在SillyTavern使用，我加入了請求限制，這個也會拖累速度。
　　通常只有動態網頁的整頁翻譯會慢一點（SillyTavern會更慢），但我覺得不影響使用，所以暫時不會再去管這個問題。
　　另外，我自己還滿推這個外掛的整頁翻譯啦。
　　之前用別的網頁翻譯，如果在JanitorAI看機器人的評論，要載入更多回覆或打開折疊的評論時，網頁一定會掛掉要重整，但這個外掛的整頁翻譯不會喔。

### ❓正規表達式是什麼？

答：送你一個[維基百科網頁](https://zh.wikipedia.org/zh-tw/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F)，再送你一個[語法整理網頁](http://www.vixual.net/blog/archives/211)。
　　簡單的範例：在Input Regex填入`韋[步布]`，在Output Replacement填入`魏布`，譯文裡的「韋步」和「韋布」都會被替代為「魏布」。
　　如果真的不知道要怎麼寫正規表達式，最簡單的方式就是土法煉鋼。例如上面的範例，只要增加兩組正規表達式，在Input Regex分別填入「韋步」和「韋布」，就會有同樣的效果。

### ❓為什麼譯文有時候沒有下引號？

答：那是Google翻譯的問題，沒有的東西我變不出來。~~主要是嫌麻煩，而且可能會誤判。~~

### ❓為什麼譯文的標點符號跟Google翻譯不一樣？

答：因為我不喜歡看到繁體中文使用””當作引號，所以目標語言設置為繁中和日文時，譯文的””會自動替換成「」。

### ❓為什麼觸發式翻譯的譯文消失了？

答：如果是在JanitorAI這種AI聊天室，由於是動態網頁，最後面的訊息會隨著用戶往上滑聊天室而消失。
　　同時，觸發式翻譯的譯文依附在原文上，當原文消失時，譯文也會消失。
　　因此當用戶往上滑聊天室後再回到最新的訊息，就會發現譯文不見了。

### ❓為什麼開啟總是翻譯此網站的功能並切換目標語言後，還是會翻譯成原本的目標語言？

答：請重整網頁。

### ❓翻譯輸入文字功能的透明度太低了，不能調高嗎？

答：之後可能會讓用戶自己調整，但不保證。

### ❓如何清除儲存的譯文？

答：請參閱【[清除快取](https://www.notion.so/1a1cbce1913780f7b850c0592ae7a0b9?pvs=21)】。

### ❓為什麼Mistral AI翻譯會跑出簡體字？

答：AI的問題。

### ❓為什麼Mistral AI翻譯的字體格式會跑掉？

答：為了順利請求翻譯，會將多個翻譯請求加入特殊標籤合併成一個翻譯請求，再於收到AI回應時重新依照特殊標籤位置來還原字體格式。
　　如果格式跑掉，那就是AI回覆時把特殊標籤放在錯誤的位置，導致格式跑掉。
　　**結論：AI的問題。**

# Extra
- 可以在DC伺服器[AI深夜奶茶店](https://discord.gg/WYAMQ5n4GE)找到我，歡迎一起加入討論AI RP。
- 可以在[Peing匿名問卷](https://peing.net/zh-TW/3f6b26aa07ac95)找到我。
- 經其他用戶測試，安卓設備的Firefox也可以使用，但我本人並無安卓設備，因此無法測試及除錯。
